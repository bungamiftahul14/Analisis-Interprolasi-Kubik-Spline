# -*- coding: utf-8 -*-
"""Untitled8.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17waCK7d2IVFmvNL6izWCVVuf6qxMaVgb
"""
import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

# =========================================================
# ALGORITMA CUBIC SPLINE MANUAL (NATURAL SPLINE)
# =========================================================
# Langkah 1  : Persamaan umum cubic spline
# Langkah 2  : Menghitung jarak antar titik (h_i)
# Langkah 3  : Syarat interpolasi (a_i = y_i)
# Langkah 4  : Kekontinuan turunan pertama & kedua
# Langkah 5  : Natural spline (c_0 = c_n = 0)
# Langkah 6  : Sistem persamaan koefisien c_i
# Langkah 7  : Hitung koefisien a_i, b_i, c_i, d_i
# Langkah 8  : Evaluasi spline
# =========================================================

def cubic_spline_manual(x, y, x_pred):
    n = len(x) - 1
    h = np.diff(x)

    # Sistem persamaan untuk c_i
    A = np.zeros((n+1, n+1))
    B = np.zeros(n+1)

    A[0, 0] = 1
    A[n, n] = 1

    for i in range(1, n):
        A[i, i-1] = h[i-1]
        A[i, i] = 2 * (h[i-1] + h[i])
        A[i, i+1] = h[i]
        B[i] = 3 * ((y[i+1] - y[i]) / h[i] -
                    (y[i] - y[i-1]) / h[i-1])

    c = np.linalg.solve(A, B)

    # Koefisien spline
    a = y[:-1]
    b = np.zeros(n)
    d = np.zeros(n)

    for i in range(n):
        b[i] = (y[i+1] - y[i]) / h[i] - h[i] * (2*c[i] + c[i+1]) / 3
        d[i] = (c[i+1] - c[i]) / (3*h[i])

    # Evaluasi spline
    for i in range(n):
        if x[i] <= x_pred <= x[i+1]:
            dx = x_pred - x[i]
            return a[i] + b[i]*dx + c[i]*dx**2 + d[i]*dx**3

    return None


# =========================================================
# KONFIGURASI HALAMAN
# =========================================================
st.set_page_config(
    page_title="Interpolasi Kubik Spline",
    page_icon="ğŸŒ¸",
    layout="centered"
)

# =========================================================
# CSS CUSTOM (TRENDY & CUTE)
# =========================================================
st.markdown("""
<style>
.block-container {
    background-color: #fff0f6;
    padding: 30px;
    border-radius: 18px;
}
.card {
    background: white;
    padding: 22px;
    border-radius: 18px;
    box-shadow: 0 8px 25px rgba(255,105,180,0.25);
    margin-bottom: 22px;
}
.result-box {
    background: linear-gradient(135deg, #ff8ec7, #ffc1dd);
    padding: 20px;
    border-radius: 16px;
    color: #6a003a;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
}
h1 { color: #ff69b4 !important; }
label { color: #c2185b !important; font-weight: bold; }
div.stButton > button {
    background-color: #ff8ec7;
    color: white;
    border-radius: 12px;
    padding: 10px 20px;
    font-weight: bold;
}
div.stButton > button:hover { background-color: #ff5fad; }
hr {
    border: none;
    height: 2px;
    background: linear-gradient(to right, #ff5fad, #ffc1dd);
    margin: 25px 0;
}
</style>
""", unsafe_allow_html=True)

# =========================================================
# HEADER
# =========================================================
st.markdown("""
<div style="text-align:center;">
    <h1>ğŸŒ¸ Interpolasi Kubik Spline ğŸŒ¸</h1>
    <p style="font-size:18px; color:#c2185b;">
        Website interpolasi Cubic Spline dengan algoritma manual ğŸ’—<br>
        Tanpa SciPy Â· Sesuai teori Â· Siap akademik
    </p>
</div>
""", unsafe_allow_html=True)

# =========================================================
# EDUKASI (OPSIONAL)
# =========================================================
with st.expander("ğŸ“š Lihat Algoritma Cubic Spline"):
    st.markdown("""
    **Langkah-langkah Cubic Spline Natural:**
    1. Menentukan persamaan spline kubik  
    2. Menghitung jarak antar titik  
    3. Menetapkan syarat interpolasi  
    4. Menjaga kekontinuan turunan  
    5. Syarat natural spline  
    6. Sistem persamaan koefisien  
    7. Menghitung koefisien spline  
    8. Evaluasi nilai spline
    """)

# =========================================================
# INPUT DATA (CARD)
# =========================================================
st.markdown("<div class='card'>", unsafe_allow_html=True)
st.subheader("ğŸ’— Masukkan Data Anda")

x_name = st.text_input("ğŸ§· Nama Variabel X", placeholder="contoh: Hari")
x_str  = st.text_input("âœ¨ Data X (pisahkan dengan koma)", placeholder="1, 2, 4, 7")

y_name = st.text_input("ğŸ§· Nama Variabel Y", placeholder="contoh: Tinggi Jagung (cm)")
y_str  = st.text_input("âœ¨ Data Y (pisahkan dengan koma)", placeholder="10, 15, 14, 20")

x_pred = st.number_input("ğŸ” Nilai X yang ingin diprediksi", placeholder="Masukkan angka")
st.markdown("</div>", unsafe_allow_html=True)

# =========================================================
# PROSES
# =========================================================
if st.button("ğŸ’– Hitung Interpolasi"):

    if not all([x_name, y_name, x_str, y_str]) or x_pred is None:
        st.error("âŒ Semua input wajib diisi")
        st.stop()

    try:
        x = np.array([float(i) for i in x_str.split(",")])
        y = np.array([float(i) for i in y_str.split(",")])
    except:
        st.error("âŒ Data harus berupa angka dan dipisahkan koma")
        st.stop()

    if len(x) != len(y) or len(x) < 3:
        st.error("âŒ Minimal 3 titik data dan jumlah X = Y")
        st.stop()

    idx = np.argsort(x)
    x, y = x[idx], y[idx]

    if not (x.min() <= x_pred <= x.max()):
        st.error("âŒ Nilai X prediksi harus dalam rentang data")
        st.stop()

    y_pred = cubic_spline_manual(x, y, x_pred)

    # HASIL
    st.markdown(f"""
    <div class="result-box">
        ğŸŒ¸ Hasil Interpolasi ğŸŒ¸ <br>
        {y_name} = <b>{y_pred:.4f}</b>
    </div>
    """, unsafe_allow_html=True)

    st.markdown("<hr>", unsafe_allow_html=True)
    st.subheader("ğŸ“ˆ Visualisasi Kurva Cubic Spline")

    # PLOT
    xx = np.linspace(x.min(), x.max(), 300)
    yy = [cubic_spline_manual(x, y, xi) for xi in xx]

    fig, ax = plt.subplots(figsize=(7,4))
    ax.set_facecolor("#fff5fb")
    fig.patch.set_facecolor("#fff0f6")

    ax.plot(xx, yy, linewidth=2, color="#ff5fa2", label="Kurva Cubic Spline")
    ax.scatter(x, y, color="#c2185b", label="Data Asli")
    ax.scatter(x_pred, y_pred, color="#007bff", s=80, label="Prediksi")

    ax.set_xlabel(x_name)
    ax.set_ylabel(y_name)
    ax.grid(True, alpha=0.3)
    ax.legend()
    st.pyplot(fig)

    # PENUTUP
    st.markdown("""
    <div style="text-align:center; font-size:17px; color:#d63384; margin-top:20px;">
        Terima kasih sudah mampir ğŸ’—<br>
        Semoga hasil interpolasimu memuaskan ğŸ€
    </div>
    """, unsafe_allow_html=True)

# =========================================================
# FOOTER
# =========================================================
st.markdown(
    "<p style='text-align:center; color:#c94f7c;'>Dibuat oleh Bunga, Aira, dan Uti ğŸ’—</p>",
    unsafe_allow_html=True
)
