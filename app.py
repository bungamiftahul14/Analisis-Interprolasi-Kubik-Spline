# -*- coding: utf-8 -*-
"""Untitled8.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/17waCK7d2IVFmvNL6izWCVVuf6qxMaVgb
"""
import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

# =========================================================
# FUNGSI KUBIK SPLINE MANUAL (NATURAL)
# =========================================================
def cubic_spline_manual(x, y, x_pred):
    n = len(x) - 1
    h = np.diff(x)  # h_i = x_{i+1} - x_i

    A = np.zeros((n + 1, n + 1))
    B = np.zeros(n + 1)

    A[0, 0] = 1
    A[n, n] = 1

    for i in range(1, n):
        A[i, i - 1] = h[i - 1]
        A[i, i] = 2 * (h[i - 1] + h[i])
        A[i, i + 1] = h[i]
        B[i] = 3 * ((y[i + 1] - y[i]) / h[i] - (y[i] - y[i - 1]) / h[i - 1])

    c = np.linalg.solve(A, B)

    a = y[:-1]
    b = np.zeros(n)
    d = np.zeros(n)

    for i in range(n):
        b[i] = (y[i + 1] - y[i]) / h[i] - h[i] * (2 * c[i] + c[i + 1]) / 3
        d[i] = (c[i + 1] - c[i]) / (3 * h[i])

    for i in range(n):
        if x[i] <= x_pred <= x[i + 1]:
            dx = x_pred - x[i]
            return a[i] + b[i] * dx + c[i] * dx**2 + d[i] * dx**3

    return None

# =========================================================
# KONFIGURASI HALAMAN
# =========================================================
st.set_page_config(
    page_title="Interpolasi Kubik Spline",
    page_icon="ðŸŒ¸",
    layout="centered"
)

# =========================================================
# CSS CUSTOM (ESTETIK + AKADEMIK)
# =========================================================
st.markdown("""
<style>
.block-container { padding:30px; }
.card {
background:white;
padding:25px;
border-radius:16px;
box-shadow:0 6px 18px rgba(0,0,0,.08);
margin-bottom:25px;
}
h1, h2 { color:#d63384; }
</style>
""", unsafe_allow_html=True)

# =========================================================
# HEADER
# =========================================================
st.markdown("""
<div class="card" style="text-align:center;">
    <h1>ðŸŒ¸ Interpolasi Kubik Spline ðŸŒ¸</h1>
    <p>
    Website sederhana metode Interpolasi Kubik Spline ðŸ’— </p>
</div>
""", unsafe_allow_html=True)

# =========================================================
# TABS 
# =========================================================
tab1, tab2, tab3 = st.tabs([
    "ðŸ“˜ Algoritma",
    "ðŸ’— Input Data",
    "ðŸ“Š Hasil"
])

# =========================================================
# TAB 1 â€” ALGORITMA
# =========================================================
with tab1:
    st.markdown("""
<div class="card">
Langkah 1  : Menuliskan persamaan umum cubic spline
Langkah 2  : Menghitung jarak antar titik (h_i)
Langkah 3  : Syarat interpolasi (spline melewati titik data)
Langkah 4  : Kekontinuan turunan pertama dan kedua
Langkah 5  : Syarat natural spline (turunan kedua di ujung = 0)
Langkah 6  : Membentuk sistem persamaan linear koefisien c_i
Langkah 7  : Menghitung koefisien a_i, b_i, c_i, d_i
Langkah 8  : Evaluasi spline pada titik x tertentu
</div>
""", unsafe_allow_html=True)

# =========================================================
# TAB 2 â€” INPUT DATA (SEDERHANA)
# =========================================================
with tab2:
st.markdown("<div class='card'>", unsafe_allow_html=True)

# Variabel X
x_name = st.text_input("Nama Variabel X", placeholder="contoh: Hari")
x_str = st.text_input("Data X (pisahkan dengan koma)", placeholder="contoh: 1, 2, 5, 7, 10")

# Variabel Y
y_name = st.text_input("Nama Variabel Y", placeholder="contoh: Tinggi Jagung (cm)")
y_str = st.text_input("Data Y (pisahkan dengan koma)", placeholder="contoh: 3, 6, 8, 11, 15")

# Prediksi
x_pred = st.number_input("Nilai X yang ingin diprediksi")

hitung = st.button("Hitung Interpolasi")

st.markdown("</div>", unsafe_allow_html=True)

# =========================================================
# TAB 3 â€” HASIL
# =========================================================
with tab3:
    if 'hitung' in locals() and hitung:
        try:
            x = np.array([float(i) for i in x_str.split(',')])
            y = np.array([float(i) for i in y_str.split(',')])
        except:
            st.error("Data X dan Y harus berupa angka")
            st.stop()
        if len(x) != len(y) or len(x) < 3:
            st.error("Minimal 3 titik dan jumlah X harus sama dengan Y")
            st.stop()
        idx = np.argsort(x)
        x, y = x[idx], y[idx]
       
        if not (x.min() <= x_pred <= x.max()):
            st.error("Nilai X prediksi harus berada dalam rentang data")
            st.stop()
        
        y_pred = kubik_spline_manual(x, y, x_pred)
        
        st.markdown("<div class='card'>", unsafe_allow_html=True)
        st.success(f"Hasil interpolasi: {y_name} = {y_pred:.4f}")
        
        xx = np.linspace(x.min(), x.max(), 300)
        yy = [kubik_spline_manual(x, y, xi) for xi in xx]

        fig, ax = plt.subplots(figsize=(7, 4))
        ax.plot(xx, yy, linewidth=2, color="#ff5fa2", label="Kurva Cubic Spline")
        ax.scatter(x, y, color="#c2185b", label="Data Asli")
        ax.scatter(x_pred, y_pred, color="#007bff", s=80,
                   label=f"Prediksi ({x_pred})")
    
        ax.set_xlabel(x_name, fontsize=11, color="#c2185b")
        ax.set_ylabel(y_name, fontsize=11, color="#c2185b")

        ax.grid(True, alpha=0.3)
        ax.legend()
        st.pyplot(fig)
    
        # PENUTUP
        st.markdown(
            """
            <div style="text-align:center; font-size:17px; color:#d63384; margin-top:20px;">
                Terima kasih sudah mampir ðŸ’—<br>
                Semoga hasil interpolasimu memuaskan ðŸŽ€
            </div>
            """,
            unsafe_allow_html=True
        )

# =========================================================
# FOOTER
# =========================================================
st.markdown("""
<p style="text-align:center; color:#c94f7c;">
Dibuat oleh <b>Bunga, Aira, dan Uti</b> ðŸ’—
</p>
""", unsafe_allow_html=True)
